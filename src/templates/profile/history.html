{% extends "base.html" %}

{% block title %}Browsing History{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>My Browsing History</h2>
    <hr>
    {% if history %}
        <ul class="list-group">
            {# Vulnerability Note: Potential performance issue rendering a very long list. #}
            {# Vulnerability Note: Potential Stored XSS if product names contain malicious script and are rendered without proper escaping (though Jinja2 autoescapes by default). #}
            {% for item in history %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <a href="{{ url_for("shop.view_product", product_id=item.product_id) }}">{{ item.name }}</a>
                        <small class="text-muted d-block">Viewed on: {{ item.viewed_at.strftime("%Y-%m-%d %H:%M:%S") }} UTC</small>
                    </div>
                    <span class="badge bg-primary rounded-pill">${{ "%.2f"|format(item.price) }}</span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>You haven't viewed any products yet.</p>
    {% endif %}
    <div class="mt-3">
        <a href="{{ url_for("profile.view_profile") }}" class="btn btn-secondary">Back to Profile</a>
    </div>
</div>
{% endblock %}

